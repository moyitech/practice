# 碳管理系统 - 项目模块说明

## 项目概述

碳管理系统（Carbon Management System）是一个基于微服务架构的碳资产管理和交易平台，主要用于管理碳信用资产、碳配额资产，提供数据统计、用户认证、系统管理等功能。

## 技术架构

### 整体架构
- **架构模式**: 微服务架构（Spring Cloud）
- **后端技术栈**: Java 21 + Spring Boot 3.1.5 + Spring Cloud 2022.0.4
- **前端技术栈**: Vue.js 2.6.14 + Element UI 2.15.14
- **数据存储**: MySQL 8.0+ + Redis 6.0+
- **消息队列**: RocketMQ 2.2.2（可选）
- **构建工具**: Maven 3.8+

### 服务端口分配
- **carbon-auth**: 9091（认证服务）
- **carbon-system**: 9092（系统服务）
- **carbon-assets**: 9093（资产服务）
- **frontend**: 8080（前端应用）

---

## 模块详细说明

### 一、后端服务模块

#### 1. carbon-auth（认证服务模块）

**模块职责**: 负责用户认证、授权、注册、登录等核心功能

**技术栈**:
- Java 21
- Spring Boot 3.1.5
- Spring Cloud 2022.0.4
- MyBatis-Plus 3.5.5
- JWT（JSON Web Token）
- Redis

**核心功能**:
1. **用户登录**
   - 用户名/密码登录
   - JWT Token生成与验证
   - 登录状态管理（Redis缓存）

2. **用户注册**
   - 账户注册
   - 手机号验证码发送
   - 账户名唯一性验证

3. **密码管理**
   - 忘记密码功能
   - 密码重置（通过手机验证码）

4. **权限验证**
   - Token验证
   - 权限校验
   - 登录状态检查

**主要接口**:
- `POST /auth/login` - 用户登录
- `GET /auth/logout` - 退出登录
- `POST /auth/register` - 用户注册
- `GET /auth/register/code/{phone}` - 获取注册验证码
- `GET /auth/forgotPassword/code/{phone}` - 获取忘记密码验证码
- `POST /auth/forgotPassword` - 忘记密码重置
- `GET /auth/verify/{accountName}` - 验证账户名是否存在

**项目结构**:
```
carbon-auth/
├── controller/          # 控制器层
│   └── LoginController.java
├── service/            # 服务层
│   ├── LoginService.java
│   ├── SmsService.java
│   └── RedisService.java
├── entity/             # 实体类
│   └── SysAccount.java
├── mapper/             # 数据访问层
│   └── LoginMapper.java
├── util/               # 工具类
│   ├── JwtUtil.java    # JWT工具类
│   └── HttpContextUtils.java
├── param/              # 请求参数类
├── vo/                 # 响应值对象
└── common/             # 通用类
    ├── ApiResult.java
    └── ApiCode.java
```

**依赖关系**:
- 通过Feign客户端调用carbon-system服务（获取账户信息）

---

#### 2. carbon-system（系统服务模块）

**模块职责**: 负责系统首页数据面板、数据统计、系统管理等功能

**技术栈**:
- Java 21
- Spring Boot 3.1.5
- Spring Cloud 2022.0.4
- MyBatis-Plus 3.5.3.1
- MySQL + Redis

**核心功能**:
1. **数据面板**
   - 首页数据统计展示
   - 账户信息展示
   - 碳资产统计（碳信用、碳配额）
   - 收入统计（资产收入、资金收入）
   - 月度数据统计（供应量、开发量、销售量）
   - 项目统计（减排总量、签约数、备案数、核准数）

2. **企业绿度**
   - 碳排放率计算
   - 能源效率率计算
   - 环境率计算
   - 绿色评分展示

3. **系统管理**
   - 账户管理
   - 租户管理
   - 角色管理

**主要接口**:
- `GET /dataPanel/home` - 获取首页数据
- `GET /dataPanel/getGreenness` - 获取企业绿度

**项目结构**:
```
carbon-system/
├── controller/          # 控制器层
│   └── DataPanelController.java
├── service/            # 服务层
│   ├── DataPanelService.java
│   └── impl/
│       └── DataPanelServiceImpl.java
├── entity/             # 实体类
│   ├── DataPanel.java
│   ├── SysAccount.java
│   └── SysTenant.java
├── mapper/             # 数据访问层
│   ├── DataPanelMapper.java
│   ├── SysAccountMapper.java
│   └── SysTenantMapper.java
└── vo/                 # 响应值对象
    ├── StatHomeDataVo.java
    ├── EnterpriseGreennessVo.java
    └── ...
```

**数据统计逻辑**:
- 从`carbon_credit_assets`表统计碳信用总量
- 从`carbon_quota_assets`表统计碳配额总量
- 从`carbon_project`表统计项目信息
- 计算资产收入 = 碳信用 + 碳配额
- 计算碳估值 = 碳排放量 × 50元/吨

---

#### 3. carbon-assets（碳资产服务模块）

**模块职责**: 负责碳信用资产和碳配额资产的管理，包括资产的增删改查、审批流程、区块链上链等功能

**技术栈**:
- Java 21
- Spring Boot 3.1.5
- Spring Cloud 2022.0.4
- MyBatis-Plus 3.5.3.1
- MySQL + Redis
- RocketMQ（可选，用于消息通知）
- 区块链服务（可选，长安链）

**核心功能**:
1. **碳信用资产管理**
   - 添加碳信用资产
   - 查询碳信用资产详情
   - 分页查询碳信用资产列表
   - 更新碳信用资产
   - 删除碳信用资产
   - 获取碳资产总额统计

2. **碳配额资产管理**
   - 添加碳配额资产
   - 查询碳配额资产详情
   - 分页查询碳配额资产列表
   - 更新碳配额资产
   - 删除碳配额资产

3. **项目库管理**
   - 碳元注册表管理
   - 项目关联管理

4. **审批流程**
   - 飞书审批消息发送（通过RocketMQ）
   - 审批状态管理

5. **区块链集成**
   - 资产上链（长安链）
   - 链上数据查询

**主要接口**:

**碳信用资产**:
- `POST /assets/carbonCreditAssets/add` - 添加碳信用资产
- `GET /assets/carbonCreditAssets/info/{id}` - 获取资产详情
- `POST /assets/carbonCreditAssets/getPageList` - 分页查询
- `PUT /assets/carbonCreditAssets/update` - 更新资产
- `POST /assets/carbonCreditAssets/delete` - 删除资产
- `GET /assets/carbonCreditAssets/assetsTotal` - 获取资产总额

**碳配额资产**:
- `POST /assets/carbonQuotaAssets/add` - 添加碳配额资产
- `GET /assets/carbonQuotaAssets/info/{id}` - 获取资产详情
- `POST /assets/carbonQuotaAssets/getPageList` - 分页查询
- `PUT /assets/carbonQuotaAssets/update` - 更新资产
- `POST /assets/carbonQuotaAssets/delete` - 删除资产

**项目结构**:
```
carbon-assets/
├── controller/          # 控制器层
│   ├── CarbonCreditAssetsController.java
│   └── CarbonQuotaAssetsController.java
├── service/            # 服务层
│   ├── CarbonCreditAssetsService.java
│   ├── CarbonQuotaAssetsService.java
│   └── feign/          # Feign客户端
│       ├── SystemServiceApi.java
│       └── ChainMakerServiceApi.java
├── entity/             # 实体类
│   ├── CarbonCreditAssets.java
│   ├── CarbonQuotaAssets.java
│   ├── CarbonMetaregistry.java
│   └── CarbonMetaregistryProject.java
├── mapper/             # 数据访问层
│   ├── CarbonCreditAssetsMapper.java
│   ├── CarbonQuotaAssetsMapper.java
│   └── CarbonMetaregistryMapper.java
├── constant/           # 常量类
│   ├── AssetsStatus.java
│   └── AssetsTradeStatus.java
└── param/              # 请求参数类
```

**资产状态管理**:
- 资产状态：待审核、已审核、已驳回等
- 交易状态：可交易、已锁定、已冻结等
- 资产数量：持仓总量、可用数量、冻结数量、锁定数量

**依赖关系**:
- 通过Feign调用carbon-system服务（获取系统信息）
- 通过Feign调用区块链服务（资产上链）

---

### 二、前端应用模块

#### frontend（前端应用）

**模块职责**: 提供用户界面，实现与后端服务的交互

**技术栈**:
- Vue.js 2.6.14
- Vue Router 3.5.1
- Element UI 2.15.14
- Axios 1.6.0
- Vuex 3.6.2（状态管理）
- Sass 1.69.5

**核心功能**:
1. **用户认证**
   - 用户登录页面
   - 用户注册页面
   - 忘记密码页面
   - Token管理
   - 路由守卫

2. **数据面板**
   - 首页数据展示
   - 碳资产统计图表
   - 项目统计展示
   - 企业绿度展示

3. **资产管理**
   - 碳信用资产管理页面
   - 碳配额资产管理页面
   - 资产列表查询
   - 资产详情查看

4. **系统管理**
   - 用户管理
   - 角色管理
   - 权限管理

**项目结构**:
```
frontend/
├── src/
│   ├── api/            # API接口封装
│   │   ├── user.js
│   │   ├── dataPanel.js
│   │   └── carbonArticle.js
│   ├── assets/         # 静态资源
│   │   └── imgs/
│   ├── router/         # 路由配置
│   │   └── index.js
│   ├── utils/          # 工具类
│   │   └── request.js  # Axios封装
│   ├── views/          # 页面组件
│   │   ├── login/      # 登录模块
│   │   ├── dashboard/  # 数据面板
│   │   ├── assets/     # 资产管理
│   │   ├── system/     # 系统管理
│   │   └── trade/      # 交易管理
│   ├── App.vue         # 根组件
│   └── main.js         # 入口文件
├── public/             # 公共资源
└── vue.config.js       # Vue配置
```

**API代理配置**:
- `/authCenter` → `http://localhost:9091` (认证服务)
- `/systemCenter` → `http://localhost:9092` (系统服务)
- `/assetsCenter` → `http://localhost:9093` (资产服务)

**主要页面**:
- `/login` - 登录页
- `/register` - 注册页
- `/home` - 首页（数据面板）
- `/assets/manage` - 资产管理
- `/assets/develop` - 资产开发
- `/system/manage` - 系统管理
- `/trade/manage` - 交易管理

---

## 模块间关系

### 服务调用关系

```
┌─────────────┐
│   frontend  │ (前端应用)
│   (8080)    │
└──────┬──────┘
       │ HTTP请求
       │
       ├─────────────────┬─────────────────┐
       │                 │                 │
       ▼                 ▼                 ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│carbon-auth  │  │carbon-system│  │carbon-assets│
│   (9091)    │  │   (9092)    │  │   (9093)    │
└──────┬──────┘  └──────┬──────┘  └──────┬──────┘
       │                 │                 │
       │                 │                 │
       │                 │                 │
       └─────────────────┴─────────────────┘
                         │
                         │ Feign调用
                         │
                    ┌────▼────┐
                    │  MySQL   │
                    │  Redis   │
                    └──────────┘
```

### 数据流向

1. **用户认证流程**:
   - 前端 → carbon-auth（登录/注册）
   - carbon-auth → Redis（Token缓存）
   - carbon-auth → carbon-system（获取账户信息）

2. **数据统计流程**:
   - 前端 → carbon-system（获取首页数据）
   - carbon-system → MySQL（查询统计数据）
   - carbon-system → carbon-assets（通过Feign获取资产数据）

3. **资产管理流程**:
   - 前端 → carbon-assets（资产操作）
   - carbon-assets → MySQL（数据持久化）
   - carbon-assets → RocketMQ（审批消息）
   - carbon-assets → 区块链服务（资产上链）

---

## 数据库设计

### 核心数据表

1. **用户相关表**
   - `sys_account` - 系统账户表
   - `sys_tenant` - 系统租户表
   - `sys_role` - 系统角色表
   - `sys_account_role` - 账户角色关联表

2. **资产相关表**
   - `carbon_credit_assets` - 碳信用资产表
   - `carbon_quota_assets` - 碳配额资产表
   - `carbon_metaregistry` - 碳元注册表
   - `carbon_metaregistry_project` - 碳元注册项目表

3. **项目相关表**
   - `carbon_project` - 碳项目表

4. **系统相关表**
   - `data_panel` - 数据面板表

---

## 部署说明

### 环境要求

- **JDK**: 21+
- **Maven**: 3.8+
- **Node.js**: 14.x+
- **MySQL**: 8.0+
- **Redis**: 6.0+
- **RocketMQ**: 2.2.2+（可选）

### 启动顺序

1. **启动基础设施**
   ```bash
   # 启动MySQL
   # 启动Redis
   # 启动RocketMQ（如需要）
   ```

2. **启动后端服务**
   ```bash
   # 1. 启动认证服务
   cd backend/carbon-auth
   mvn spring-boot:run
   
   # 2. 启动系统服务
   cd backend/carbon-system
   mvn spring-boot:run
   
   # 3. 启动资产服务
   cd backend/carbon-assets
   mvn spring-boot:run
   ```

3. **启动前端应用**
   ```bash
   cd frontend
   npm install
   npm run serve
   ```

### 配置说明

各模块的配置文件位于：
- `backend/{module}/src/main/resources/application.yml` - 主配置
- `backend/{module}/src/main/resources/application-dev.yml` - 开发环境配置

需要配置的主要项：
- 数据库连接信息
- Redis连接信息
- 服务端口
- RocketMQ配置（如需要）
- 区块链服务配置（如需要）

---

## 开发规范

### 代码结构规范

所有后端模块遵循统一的分层架构：
- `controller/` - 控制器层（处理HTTP请求）
- `service/` - 服务层（业务逻辑）
- `mapper/` - 数据访问层（数据库操作）
- `entity/` - 实体类（数据库表映射）
- `param/` - 请求参数类
- `vo/` - 响应值对象
- `common/` - 通用类
- `config/` - 配置类
- `util/` - 工具类

### API规范

- 统一使用`ApiResult`作为响应格式
- 统一使用RESTful API风格
- 统一异常处理机制

### 命名规范

- 类名：PascalCase（如：`LoginController`）
- 方法名：camelCase（如：`getUserInfo`）
- 常量：UPPER_SNAKE_CASE（如：`MAX_RETRY_COUNT`）

---

## 后续规划

### 待开发功能

1. **交易模块**
   - 碳资产交易功能
   - 交易订单管理
   - 交易结算

2. **报表模块**
   - 数据报表生成
   - 报表导出功能
   - 数据可视化

3. **消息通知**
   - 站内消息
   - 邮件通知
   - 短信通知

4. **文件管理**
   - 文件上传
   - 文件存储
   - 文件下载

### 技术优化

1. 服务注册与发现（Nacos/Eureka）
2. 配置中心（Nacos Config）
3. API网关（Spring Cloud Gateway）
4. 分布式链路追踪（Sleuth + Zipkin）
5. 服务监控（Prometheus + Grafana）

---

## 联系方式

- **项目维护**: Carbon Team
- **开发时间**: 2026-01-06
- **技术支持**: 请联系开发团队

---

## 许可证

Copyright © 2026 Carbon Management System


