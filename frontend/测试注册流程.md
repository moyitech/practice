# 测试注册流程说明

## 当前服务状态

✅ **Carbon-Auth 服务**: 运行中（端口9091）  
✅ **Carbon-System 服务**: 需要启动（端口9092）  
✅ **前端服务**: 运行中（端口8081）  
✅ **MySQL**: 运行中  
✅ **Redis**: 运行中  

## 注册测试步骤

### 1. 访问注册页面
打开浏览器访问：http://localhost:8081/#/register

### 2. 填写注册信息

#### 示例1：使用测试账号
- **用户名**: testuser001
- **手机号**: 13800138000
- **验证码**: 点击"获取验证码"后，查看后端日志获取
- **密码**: 123456
- **确认密码**: 123456

#### 示例2：使用另一个测试账号
- **用户名**: zhangsan
- **手机号**: 13900139000
- **验证码**: 点击"获取验证码"后，查看后端日志获取
- **密码**: 123456
- **确认密码**: 123456

### 3. 获取验证码

点击"获取验证码"按钮后，有两种方式查看验证码：

#### 方式1：查看后端日志
```bash
# 在终端中运行（实时查看日志）
tail -f /tmp/carbon-auth.log | grep "验证码"
```

或者在IDE的终端窗口中查看，日志格式如下：
```
2026-01-06T12:36:00.380+08:00  INFO 23629 --- [nio-9091-exec-2] c.c.auth.service.impl.SmsServiceImpl     : 发送注册验证码到手机号: 18334621111, 验证码: 083962
```

#### 方式2：查看Redis中的验证码
```bash
# 连接Redis
redis-cli

# 查看验证码（替换手机号）
GET sms:register:13800138000
```

### 4. 输入验证码并注册

⚠️ **重要提示**：
- 验证码有效期为 **60秒**
- 必须在60秒内完成注册
- 如果超时，需要重新获取验证码

### 5. 注册成功

注册成功后会自动跳转到登录页面，显示提示：
```
恭喜您注册成功，请直接登录。
```

## 常见问题

### Q1: 提示"验证码错误"
**原因**: 输入的验证码与后端生成的不一致

**解决方案**:
1. 检查后端日志，确认最新生成的验证码
2. 确保输入的验证码完全正确（6位数字）
3. 注意不要有空格或其他字符

### Q2: 提示"验证码已过期"
**原因**: 验证码超过60秒有效期

**解决方案**:
1. 重新点击"获取验证码"按钮
2. 在60秒倒计时内完成注册

### Q3: 提示"用户名已被注册"
**原因**: 该用户名已存在于数据库中

**解决方案**:
1. 更换一个新的用户名
2. 或者使用已存在的账号登录

### Q4: 提示"手机格式错误"
**原因**: 手机号格式不正确

**解决方案**:
1. 确保输入11位手机号
2. 手机号必须以1开头
3. 格式示例：13800138000

### Q5: 无法获取验证码
**原因**: 后端服务未启动或网络问题

**解决方案**:
1. 检查carbon-auth服务是否运行
2. 检查浏览器控制台是否有错误
3. 确认Redis服务是否运行

## 测试用例

### 测试用例1：正常注册流程
```
用户名: testuser001
手机号: 13800138000
验证码: [从日志获取]
密码: 123456
确认密码: 123456

预期结果: 注册成功，跳转到登录页
```

### 测试用例2：验证码错误
```
用户名: testuser002
手机号: 13800138001
验证码: 000000 (故意输错)
密码: 123456
确认密码: 123456

预期结果: 提示"验证码错误"
```

### 测试用例3：密码不一致
```
用户名: testuser003
手机号: 13800138002
验证码: [从日志获取]
密码: 123456
确认密码: 654321

预期结果: 提示"两次输入的密码不一致"
```

### 测试用例4：用户名已存在
```
用户名: admin (已存在)
手机号: 13800138003
验证码: [从日志获取]
密码: 123456
确认密码: 123456

预期结果: 提示"用户名已被注册"
```

## 快速测试命令

### 1. 启动所有服务
```bash
# 启动carbon-auth（如果未运行）
cd /Users/mengxianze/Desktop/project/cursor-design-1/backend/carbon-auth
mvn spring-boot:run &

# 启动carbon-system（如果未运行）
cd /Users/mengxianze/Desktop/project/cursor-design-1/backend/carbon-system
mvn spring-boot:run &

# 启动前端（如果未运行）
cd /Users/mengxianze/Desktop/project/cursor-design-1/frontend
npm run serve &
```

### 2. 查看服务状态
```bash
# 检查端口占用
lsof -i:9091  # carbon-auth
lsof -i:9092  # carbon-system
lsof -i:8081  # frontend

# 查看进程
ps aux | grep -E "carbon-auth|carbon-system|npm"
```

### 3. 测试接口
```bash
# 测试验证账户接口
curl http://localhost:9091/auth/verify/testuser001

# 测试获取验证码接口
curl http://localhost:9091/auth/register/code/13800138000

# 测试注册接口
curl -X POST http://localhost:9091/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "accountName":"testuser001",
    "phone":"13800138000",
    "code":"[从日志获取]",
    "password":"123456",
    "confirmPassword":"123456"
  }'
```

## 成功注册后的操作

### 1. 登录系统
访问：http://localhost:8081/#/login
- 用户名: testuser001
- 密码: 123456

### 2. 查看首页
登录成功后会自动跳转到首页，显示：
- 用户信息
- 欢迎信息
- 退出登录按钮

### 3. 测试退出登录
点击"退出登录"按钮，会返回登录页面

## 数据库验证

### 查看注册的账户
```sql
-- 连接MySQL
mysql -u root -p13579MXZmxz... carbon

-- 查看所有账户
SELECT id, account_name, phone, account_status, created_time 
FROM sys_account 
ORDER BY id DESC 
LIMIT 10;

-- 查看特定账户
SELECT * FROM sys_account WHERE account_name = 'testuser001';
```

### 查看Redis中的数据
```bash
# 连接Redis
redis-cli

# 查看所有验证码
KEYS sms:register:*

# 查看特定验证码
GET sms:register:13800138000

# 查看所有登录信息
KEYS login:user:*
```

## 注意事项

1. ⏰ **验证码有效期**: 60秒，请及时使用
2. 🔒 **密码要求**: 6-16位，建议使用字母+数字组合
3. 📱 **手机号**: 11位，以1开头
4. 👤 **用户名**: 唯一，不能重复
5. ✅ **注册成功**: 自动跳转登录页
6. 🔄 **验证码**: 每次获取都会生成新的验证码

## 开发调试技巧

### 1. 实时查看日志
```bash
# 查看carbon-auth日志
tail -f /tmp/carbon-auth.log

# 只看验证码相关日志
tail -f /tmp/carbon-auth.log | grep "验证码"

# 只看错误日志
tail -f /tmp/carbon-auth.log | grep "ERROR"
```

### 2. 清理测试数据
```sql
-- 删除测试账户
DELETE FROM sys_account WHERE account_name LIKE 'test%';

-- 重置自增ID（可选）
ALTER TABLE sys_account AUTO_INCREMENT = 2;
```

### 3. 清理Redis缓存
```bash
redis-cli FLUSHDB  # 清空当前数据库
# 或
redis-cli DEL sms:register:13800138000  # 删除特定key
```

---

**祝您测试顺利！** 🎉

如有问题，请查看：
- 后端日志: `/tmp/carbon-auth.log`
- 前端控制台: 浏览器开发者工具 (F12)
- 项目文档: `PROJECT_SUMMARY.md`









